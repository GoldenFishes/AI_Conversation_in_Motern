

## 1. 测试流程



我们需要一个标准化的bad case测试和验证流程，其需要：

- 构建Bad Case数据集

  - 数据集获取：

    从监控网页中直接下载图像帧和检测结果的数据对（同时包含其他日志信息）

  - 数据集加载：

    从监控网页中加载上传数据集，能够看到已有数据集的可视化效果

- 构建追踪算法的测试脚本

  - 构建测试脚本：

    该测试脚本不是全流程测试脚本，该脚本加载数据集中边端推理检测模型的结果，在此基础上只验证追踪部分算法。是追踪部分的局部测试脚本。

  - 构建验证指标评估方法：

    已知数据集的真实检测结果，追踪算法的推理结果可以进行比对

  后续基于相关滤波的追踪算法和深度学习的追踪算法均可使用该测试脚本，方便快速即插即用地验证。



## 2. 测试数据集格式

数据集总览如下：

```python
└──test_dataset
    ├──video_0001
    |   ├──images                     # 存放视频帧的文件夹
    |   |   ├──frame_0001.jpg
    |   |   ├──frame_0002.jpg
    |   |   ...
    |   |   └──frame_XXXX.jpg
    |   ├──detect_annotation          # 每一帧的检测结果标注
    |   |   ├──frame_0001.json
    |   |   ├──frame_0002.json
    |   |   ...
    |   |   └──frame_XXXX.json
    |   └──all_info                   # 每一帧对应的安卓端和算法端日志信息
	|       ├──frame_0001.json
    |       ├──frame_0002.json
    |       ...
    |       └──frame_XXXX.json
    ├──video_0002 
	...
    ├──video_XXXX
    └──data_info.txt                  # 用于说明该数据集的规格（视频规格，标注规格等）
```

其中每个视频用一个 `video_XXXX` 视频编号命名的文件夹承载。在每个视频对应的文件夹下：

- `images`文件夹：

  存放该条视频的所有视频帧，以 `.jpg` 格式存储；以 `frame_{四位数帧索引}.jpg` 命名。

- `detect_annotation`文件夹：

  存放该条视频每帧所对应的检测结果标注，以对应帧的索引命名 `frame_{四位数帧索引}.json` 的JSON文件。文件内容如下：

  ```json
  [
      {
          "id":17,
          "location":{
              "bottom":132.50513,
              "left":160.52359,
              "right":175.47101,
              "top":119.27372
          }
      },
      {
          "id":13,
          "location":{
              "bottom":293.13867,
              "left":119.11305,
              "right":134.03415,
              "top":279.63235
          }
      },
      ...
  ]
  ```

  JSON中存放一个List，其中包含每个球的检测结果。每个球的检测结果用一个Dict包裹，包含两个字段：

  - `id` : 检测返回的球的id
  - `location` : 检测返回该球的上下左右坐标（未归一化的）

- `all_info`文件夹：

  存放该条视频每帧所对应的日志信息，以对应帧的索引命名 `frame_{四位数帧索引}.json` 的JSON文件。文件内容如下：

  ```json
  {
      "android_info":{
          "code": 102,
          "content": {
              "results":[
                  {"confidence":0.9763056,"id":4,"location":{"bottom":346.66165,"left":29.006409,"right":625.0857,"top":14.509552},"trackId":0},
                  {"confidence":0.9397569,"id":3,"location":{"bottom":336.17947,"left":35.110615,"right":71.11554,"top":300.27216},"trackId":0},
                  {"confidence":0.9397569,"id":3,"location":{"bottom":55.28732,"left":32.53502,"right":68.74834,"top":18.57882},"trackId":0},
                  {"confidence":0.9397569,"id":3,"location":{"bottom":56.18007,"left":587.19226,"right":623.2882,"top":19.917273},"trackId":0},
                  {"confidence":0.9397569,"id":3,"location":{"bottom":340.42477,"left":309.42355,"right":333.64725,"top":311.11554},"trackId":0},
                  {"confidence":0.9397569,"id":2,"location":{"bottom":132.42519,"left":161.04195,"right":175.29506,"top":118.93393},"trackId":0},
                  {"confidence":0.9397569,"id":2,"location":{"bottom":293.13748,"left":119.28596,"right":133.77377,"top":279.8125},"trackId":0},
                  {"confidence":0.9397569,"id":3,"location":{"bottom":47.81946,"left":312.53635,"right":337.6869,"top":16.536562},"trackId":0},
                  {"confidence":0.9323862,"id":2,"location":{"bottom":310.95374,"left":272.35443,"right":285.7757,"top":297.82504},"trackId":0},
                  {"confidence":0.906589,"id":3,"location":{"bottom":341.0061,"left":579.53723,"right":613.04706,"top":308.4113},"trackId":0}
              ],
              "timestamp":1754538051890
          },
          "from": "d0:5f:64:d5:d5:0a",
          "fromType": "android",
          "msg": "Ball Info",
          "time": 1754538051890
      },
      "algorithm_info":{
          "code": 104,
          "content": {
              "results":[
                  {"id":13,"confidence":0.9397568702697754,"location":{"bottom":293.38043212890625,"left":119.4378890991211,"right":134.06890869140625,"top":279.8810729980469}},
                  {"id":9,"confidence":0.9250155687332153,"location":{"bottom":310.9519958496094,"left":272.24591064453125,"right":285.8553771972656,"top":297.70538330078125}},
                  {"id":17,"confidence":0.9397568702697754,"location":{"bottom":132.37356567382812,"left":160.79966735839844,"right":175.43621826171875,"top":119.00239562988281}}
              ],
              "timestamp":1754538051856
          },
          "from": "d0:5f:64:d5:d5:0a",
          "fromType": "algorithm",
          "msg": "球跟踪位置信息",
          "time": 1754538051856
      }
  }
  ```

  JSON中包含两个字段：

  - `android_info` : WebSoket中监控程序展示的安卓端消息字典
  - `algorithm_info` : WebSoket中监控程序展示的算法端消息字典

  



## 3. 方案尝试

- 相关滤波追踪算法：

  可以加上动量的限制。

- 深度学习追踪算法：

  Dence Optical Tracking，TAPNext