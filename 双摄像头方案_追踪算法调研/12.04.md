#### 双摄像头方案

背景：犯规行为的识别没有达到预期

描述：犯规行为当前仅实现 `白球进袋`、`进球是合法目标球`，且都是通过球是否消失在桌台中进行策略处理，原因是受限于单个摄像头无法检测出台球高速移动产生的形变拖影。也是因为这个原因导致其他期望实现的犯规行为受限。

期望实现：

![image-20241202163538256](..\双摄像头方案_追踪算法调研\asset\image-20241202163538256.png)

抽象理解可分为三大功能的实现：

1. 什么球碰撞了什么球？----> 满足：击打合法检测

2. 什么球进了什么袋？----> 满足：教练考级需求

3. 什么球在什么时候撞击库边？ ----> 满足：撞库检测

   

   **双摄像头方案**：在于充分利用两个摄像头的优势，互补不足，建立一个稳健的多传感器跟踪系统。

   算法层架构：

![a45c0bffd570b85a565a81acb15b1e6d](..\双摄像头方案_追踪算法调研\asset\a45c0bffd570b85a565a81acb15b1e6d.jpg)

**关键点**

- 对齐

​	时间对齐：来自高帧率摄像头的图像隔帧推理，近似与来自低帧率摄像头的图像时间对齐。或者，图像帧中带有绝对时间信息，做高低帧率摄像头匹配

​	空间校准：确保两个摄像头的视角对齐，通过标定获取两者之间的空间变换关系（如内参和外参），以便在同一坐标系下进行融合。

===> 获得球静止状态下 Camera B view中对应球的属性（class、xywh、conf）

- 轨迹追踪

​	使用合适的运动跟踪算法来跟踪Camera B中检测到的球

- 数据关联

​	将Camera A中的物体与Camera B中的物体进行关联。每个物体在B视图中的ID被标记，以便于追踪和分析

​	![3bcd78ed280c12112976ea4c935d6023](..\双摄像头方案_追踪算法调研\asset\3bcd78ed280c12112976ea4c935d6023.jpg)

**运动跟踪算法选型**

目前，主流的多目标跟踪方法是**TBD**（Tracking-by-Dectection），即与目标检测算法相结合的跟踪方法。TBD方法在每一帧都进行目标检测，再利用目标检测的结果进行追踪。

SORT类的算法都可以概括为以下几个关键步骤：

1. **目标检测**：SORT依赖于目标检测算法（如YOLO、SSD等）来识别视频帧中的目标。每一帧中，算法会输出目标的边界框（bounding box）及其置信度。

2. **卡尔曼滤波**：SORT使用卡尔曼滤波器来预测目标的位置和速度。卡尔曼滤波是一种递归滤波器，能够根据当前的观测值和先前的状态估计目标的未来状态。通过对目标的运动进行建模，SORT能够在目标暂时消失或被遮挡时进行预测。

3. **匈牙利算法**：为了将检测到的目标与之前的跟踪目标进行关联，SORT使用匈牙利算法来解决数据关联问题。该算法通过最小化成本矩阵（通常是基于目标之间的距离）来确定当前帧中的检测框与之前帧中的跟踪框之间的最佳匹配。

4. **更新状态**：一旦确定了匹配关系，SORT会更新卡尔曼滤波器的状态，以反映新的观测值。这包括更新目标的位置、速度和其他状态信息。

5. **管理目标**：SORT还需要管理目标的生命周期，包括添加新目标和删除丢失的目标。当检测到新的目标时，SORT会为其创建新的跟踪实例；如果某个目标在连续几帧中未被检测到，则会将其标记为丢失并最终删除

   

#### **SORT**

**优点**

- **轻量级**：算法简单，计算效率高，适合实时应用。
- **依赖检测器**：仅依赖目标检测器的输出（如边界框），不需要额外的特征提取。
- **易于实现**：基于卡尔曼滤波和匈牙利算法，易于理解和部署。

**缺点**

- **对遮挡敏感**：无法处理长时间遮挡或目标丢失的情况，容易导致ID切换（ID Switch）。

- **缺乏外观信息**：仅依赖运动信息（如位置和速度），在目标特征相似的情况下容易混淆。

- **对高速运动适应性差**：卡尔曼滤波假设目标运动平稳，高速运动可能导致预测误差较大。

  

#### **DeepSORT**

**优点**

- **结合外观特征**：在SORT的基础上加入了深度学习提取的外观特征（ReID），通过余弦相似度匹配目标，显著提升了遮挡情况下的跟踪性能。
- **鲁棒性强**：在目标遮挡、运动轨迹复杂的情况下表现更好。
- **适应性广**：适合目标特征相似度较低的场景。

**缺点**

- **计算开销大**：需要额外的特征提取网络，计算成本较高，不适合资源受限的实时场景。

- **依赖检测器质量**：检测器的误检或漏检会直接影响跟踪效果。

- **特征混淆**：当目标外观特征差异很小时，ReID特征可能失效。

  

#### **ByteTrack**

**优点**

- **高效利用检测结果**：不仅利用高置信度检测框，还利用低置信度检测框进行匹配，显著降低了漏检对跟踪的影响。
- **实时性强**：优化了匹配策略，计算效率高，适合实时应用。
- **鲁棒性强**：在目标密集、遮挡严重的场景中表现优异。
- **对检测器依赖较低**：通过低置信度框的匹配，缓解了检测器误检和漏检的问题。

**缺点**

- **对外观特征依赖较少**：主要依赖运动信息，虽然在大多数场景中表现良好，但在目标特征高度相似的情况下可能会出现混淆。
- **复杂场景下可能需要调整参数**：例如置信度阈值的设置对性能有较大影响。

![img](..\双摄像头方案_追踪算法调研\asset\e01b695a4f1ba6ab993932b55205c6d3.jpeg)