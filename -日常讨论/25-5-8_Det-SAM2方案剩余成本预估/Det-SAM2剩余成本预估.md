## Det-SAM2方案推进剩余成本预估

本成本预估基于当前Det-SAM2效果与预期目标效果之差



### 1. 当前性能

#### 1.1 Det-SAM2项目背景

Meta开源SAM2具有强大的视频追踪能力，我们认为它能为遮挡、碰撞等复杂台球追踪场景带来的提升，超越传统基于检测的追踪算法。

为了能够合理使用SAM2基于提示的纠正能力，我们构建了Det-SAM2：一个真正无人工干预的由检测模型自动提供物体提示以供SAM2推理和修正的pipeline。pipeline允许以恒定的显存与内存开销一次性推理无限长的视频流并且在效率和精度上与原始SAM2持平。

技术报告：[[2411.18977\] Det-SAM2:Technical Report on the Self-Prompting Segmentation Framework Based on Segment Anything Model 2](https://arxiv.org/abs/2411.18977)



#### 1.2 Det-SAM2-pipeline效果展示

(见`asset`文件夹)

后处理可视化依赖于后处理超参数，然而当前后处理超参数并未调整至最优组合。



#### 1.3 Det-SAM2-pipelin的性能开销

Det-SAM2-pipeline 在 1920*1080 分辨率下，每帧 0.025GB 显存。通过仅维持一定数量帧缓存实现恒定显存。

Det-SAM2-pipeline RTX4090 上推理 1920*1080 分辨率 : 1.5 帧/秒



### 2. 后续工作



#### 2.1 部署Demo

将现有 Det-SAM2-pipeline 直接对接业务部署Demo

**类型：**

部署、调试

**目标：**

实现展厅接入现有业务逻辑的完整功能Demo

**实现方式：**

Det-SAM2-pipeline部署4090，开放接口，接收rtsp视频流，输出推理结果。

**成本：**

算法成本零；

服务器计算成本忽略不计；

与现有业务逻辑融合，业务调试时间成本暂无相关信息以供预估



#### 2.2 寻找最优参数组合

在我们构建的 Det-SAM2  自动评估工作流基础上，以多种超参数组合推理评估数据集，找到最优参数组合

**类型：**

框架的参数优化

**目标：**

确定Det-SAM2-pipeline的后处理参数，在业务判断（进球、碰撞、翻袋）上达到甚至超过原有分割结果的准确度

**实现方式：**

使用自动评估脚本自动运行

**成本：**

服务器计算与时间成本大约 250 个 RTX4090 小时，及不可预估的突发debug时间

人员研发成本忽略不计；



#### 2.3 Det-SAM2推理策略优化

继续完善一些可以提升推理速度和推理效率的点，改善Det-SAM2-pipeline最终性能

**类型：**

框架继续改进迭代

**目标：**

降低推理开销，提升推理速度

**实现方式：**

1. 尝试低分辨率的SAM2推理，期望可以带来4倍的速度提升。
   检测模型在高分辨率下得到结果，给出相对坐标提示，SAM2在低分辨率下进行推理
2. 在推理时，输入prompt产生条件帧时禁用这一帧去生成mask，以加速。
   track_step不必须使用条件帧的mask，因此我们很多条件帧不需要走mask decoder，只需要过memory encoder之后就可以直接拿去propragate传播

**成本：**

服务器计算成本忽略不计；

人员研发成本约 15-25 天/人



#### 2.4 SAM2轻量化

解冻LiteSAM2项目，继续推进SAM2轻量化。从模型层直接提升推理精度，降低推理资源开销。

**类型：**

模型训练、轻量化

**目标：**

将SAM2模型进行轻量化并在训练过程中提升我们私有场景上的表现。初步期望在维持当前SAM2的90%精度前提下，提升4-5倍推理速度。

**实现方式：**

构建私有数据引擎/标注工具

参考EfficientTAM与SAM2代码及其他SAM系列蒸馏工作，使用知识蒸馏训练一个轻量级的视频分割模型。

**成本：**

（数据成本暂不在此项中计算）

服务器计算成本 >> 1000 RTX4090 小时，具体无法预估；

人员研发成本约 330 天/人



#### 2.5 构建 LiteSAM2 数据集

为SAM2轻量化提供足够的私有场景的数据

**类型：**

数据标注工具搭建、数据标注

**目标：**

为SAM2轻量化提供足量的私有场景数据

在预计标注成本下获得 30FPS 总计 2000 秒私有场景数据  （根据LiteSAM2早期尝试，非常粗略的估计，相差1-2个数量级以内）

**实现方式：**

采集数据，搭建数据标注工具，在此基础上对已采集数据进行标注

**成本：**

服务器计算忽略不计；

人员研发成本约 3-7 天/人

人员标注成本约 180 天/人



### 3. 成本预估总结

| 目标                                                         | 人员耗时成本（粗略预估）            | 计算服务成本（粗略预估） |
| ------------------------------------------------------------ | ----------------------------------- | ------------------------ |
| 现有成果直接部署Demo                                         | 5-15天/人                           | /                        |
| 计算现有成果的准确率上限<br />运行自动评估脚本，寻找最优参数 | 1-5天/人                            | > 250 RTX4090 GPU小时    |
| Det-SAM2推理策略优化（不训练）                               | 15-25 天/人                         | /                        |
| 核心性能提升（精度、开销）<br />推进LiteSAM2项目             | ≈330 天/人                          | > 1000 RTX4090 GPU小时   |
| 构建SAM2训练数据集                                           | 研发 3-15 天/人<br />标注 180 天/人 | /                        |
|                                                              |                                     |                          |
|                                                              |                                     |                          |



- 特别说明：
  当前MotenAI预计在7月份将Allen（Muti-Agent System）项目转为平稳迭代状态后，也会正常同步推进LiteSAM2项目。